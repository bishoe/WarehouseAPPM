
(function () {
    deferLogin();
})();

function deferLogin() {
    if (window.jQuery)
        domReadyLogin();
    else
        setTimeout(function () { deferLogin() }, 100);
}

function domReadyLogin() {
    jQuery('#UserDetailContainer').mouseover(function () {
        jQuery('#LogoutSpan').show();
    });

    jQuery('.loginPopup.loggedIn').mouseover(function () {
        jQuery('#LogoutSpan').show();
        jQuery('.userdetailCntr').addClass('hover');
    });

    jQuery('#UserDetailContainer').mouseout(function () {
        jQuery('#LogoutSpan').hide();
    });

    jQuery('.loginPopup.loggedIn').mouseout(function () {
        jQuery('#LogoutSpan').hide();
        jQuery('.userdetailCntr').removeClass('hover');
    });



    var close = true;
    jQuery('.notificationMessageCntr').click(function () {
        var id = jQuery(this)[0].id;
        if (id != 'askQuestion') {
            if (jQuery(this).next().is(':visible')) {
                jQuery(this).find('.arrow').hide();
                jQuery(this).next().hide();
            }
            else {
                jQuery('.msg_container').hide();
                jQuery('.notificationMessageCntr .arrow').hide();
                close = false;
                jQuery(this).find('.arrow').show();
                jQuery(this).next().show();
                ResetNotificationCount(this);
            }
        }
    });

    jQuery('.msg_container').click(function () {
        close = false;
    });

    jQuery(document).click(function () {
        if (close) {
            jQuery('.notificationMessageCntr .arrow').hide();
            jQuery('.msg_container').hide();
        }
        close = true;
    });



    jQuery(window).scroll(function () {
       
        var topS = jQuery(window).scrollTop();
        var winWidth = jQuery(window).width();
        var headerHe = jQuery(".topHeaderConainer").height() - jQuery(".HeadermenuStripBlue").height() - jQuery("#HeaderAdvertise").height();

        // header js 
        if (topS > (headerHe + jQuery(".HeadermenuStripBlue").height())) {

            if (parseInt(winWidth) < 767) {
                jQuery(".HeadermenuStripBlue").css("position", "fixed");
                jQuery("#blankDiv").show();
            }
            else {
                if (jQuery(".csharp-notification").is(":visible")) {

                    jQuery(".HeadermenuStripBlue").css({ "position": "fixed", "top": "50px" });
                    jQuery("#blankDiv").show();
                }

                else {

                    jQuery(".HeadermenuStripBlue").css({ "position": "fixed", "top": 0 });
                    jQuery("#blankDiv").show();
                }

            }
        }
        else if (topS <= (headerHe + jQuery(".HeadermenuStripBlue").height())) {
            jQuery(".HeadermenuStripBlue").css({ "position": "relative", "top": "auto" });
            jQuery("#blankDiv").hide();
        }
    });

    jQuery(window).resize(function () {
        if (jQuery(".menuButton").is(':visible')) {
            var windowHeight = jQuery(window).height();
            jQuery('.responsiveHeader .responsiveMenu').css("height", windowHeight);
        }
        else {
            jQuery('.responsiveHeader .responsiveMenu').css("height", 'auto');
        }
    });
    jQuery(".menuButton").click(function () {
        var windowHeight = jQuery(window).height();
        var menu_container = jQuery('.responsiveHeader .responsiveMenu');
        if (!menu_container.hasClass('hidden')) {
            menu_container.animate({ left: 0 });
            jQuery('body, .responsiveHeader').animate({ left: 260 + 'px' });
            menu_container.addClass('hidden');
            menu_container.css("height", windowHeight);
            jQuery('body').css({ 'height': windowHeight, 'overflow': 'hidden', 'position': 'fixed' });

        } else {
            menu_container.animate({ left: -260 + 'px' });
            jQuery('body ,.responsiveHeader').animate({ left: 0 + 'px' });
            menu_container.removeClass('hidden');
            jQuery('body').css({ 'height': windowHeight, 'overflow-y': 'auto', 'position': 'relative' });
        }
    });

    if (jQuery(".icons.comments").length > 0 || jQuery(".icons.message").length > 0 || jQuery(".icons.notification").length > 0) {
        setInterval(function () {
            GetNotificationCounts();
        }, 60000);
    }

    /*Preventing question mark for searchbox*/
    if (jQuery("#HeaderSearch").length > 0) {
        jQuery('#HeaderSearch').bind('keydown', preventQuestionMark);
    }
    if (jQuery('#searchTextBox').length > 0) {
        jQuery('#searchTextBox').bind('keydown', preventQuestionMark);
    }
    if (jQuery('#ctl00$HeaderHomeNewDesign$searchTextBox').length > 0) {
        jQuery('#ctl00$HeaderHomeNewDesign$searchTextBox').bind('keydown', preventQuestionMark);
    }
    //For Interview Section
    if (jQuery('#TextBoxSearchText').length > 0) {
        jQuery('#TextBoxSearchText').bind('keydown', preventQuestionMark);
    }

    jQuery("#btnHeaderSearch").click(function () {
        jQuery("#HeaderSearch").focus();
    });
    setTimeout(function () {
        if (typeof (arrInFocus) != "undefined") {
            animateinFocus();
        }
    }, 5000);

    /*Scroll To Top - Begin*/
    jQuery("body").append("<a href='javascript:void(0);' id='ScrollToTop'><i class='c-icon icon-up-arrow'></i></a>");

    jQuery("<style>")
    .attr("type", "text/css")
    .html("\
        .scrollToTop{padding:10px 12px;position:fixed;bottom:8px;right:8px;display:none;background:#0086dc;z-index:999;-webkit-transition:all 0.3s;-moz-transition:all 0.3s;-o-transition:all 0.3s;transition:all 0.3s;} .scrollToTop:hover{background:#252525;}")
        .appendTo("head");

    jQuery("body").prepend("<a href='javascript:void(0);' class='scrollToTop'>\
                            <svg xmlns='http://www.w3.org/2000/svg' width='20px' height='20px' viewBox='0 0 20 20'>\
                                <polygon fill='#FFFFFF' points='10,3.9 0,13.9 2.2,16.1 10,8.3 17.8,16.1 20,13.9 10,3.9 10,3.9 '/>\
                            </svg></a>");

    jQuery(window).scroll(function () {
        (jQuery(this).scrollTop() > 100) ? jQuery('.scrollToTop').fadeIn() : jQuery('.scrollToTop').fadeOut();
    });

    jQuery('.scrollToTop').click(function () {
        jQuery('html, body').animate({ scrollTop: 0 }, 800);
        return false;
    });

    /*Scroll To Top - End*/

    jQuery(".msg_container ul").bind('mousewheel', function (e) {
        if (e.originalEvent.wheelDelta / 120 <= 0) {
            if (jQuery(this).find("li").last().offset().top <= jQuery(this).height()) {
                e.preventDefault();
                e.stopPropagation();
            }
        }
    });

    /* Don't show HeaderAd at restricted section */
    var restrictedSection = ["advertiser"];
    var section = window.location.href.toLowerCase().replace(/^https?:\/\//, '').split('/')[1];
    if (restrictedSection.indexOf(section) === -1) {
        setTimeout(function () {
            var headerAds = jQuery("#HeaderAdvertise");
            if (headerAds.length > 0) {
                GetHeaderAd();
            }
        }, 1200);
    }


}






//Reset notification count
//type: 1- Message Notification, 2- Comment Notification
function ResetNotificationCount(container) {
    var type = 0;
    if (jQuery(container).attr('id') == 'messageNotification')
        type = 1;
    else if (jQuery(container).attr('id') == 'commentNotification')
        type = 2;
    else if (jQuery(container).attr('id') == 'generalNotifications')
        type = 3;

    if (type != 0) {

        jQuery.ajax({
            url: "/Handlers/CsharpCommon.ashx?method=reset_notification_message_count&type=" + type,
            type: "POST",
            async: false,
            dataType: "JSON",
            contentType: "application/JSON",
            beforeSend: function () {
                if (type == 1)
                    jQuery('#imgComments').show();
                if (type == 2)
                    jQuery('#imgMessages').show();
                if (type == 3)
                    jQuery('#imgGeneralNotifications').show();
            },
            success: function (data) {
              
                jQuery(container).find('.messageCount').hide();
                if (data != null && data != "") {
                    //data = JSON.parse(data);
                    if (data == 'login') {
                        jQuery('#LabelNoDataNotifications').show();
                        return false;
                    }
                    var obj = "";
                  
                    if (type == 1) {
                        obj = '';
                        jQuery(data).each(function () {
                         
                            var date = new Date(this.Date + "Z");
                            var normalizedDate = new Date(date.getTime() - date.getTimezoneOffset() * -60000);
                            var formattedDate = normalizedDate.toLocaleTimeString('en-US', {
                                day: 'numeric',
                                month: 'short',
                                year: 'numeric',
                            hour: '2-digit', 
                            minute:'2-digit'
                            });

                            obj += "<li><a href='" + this.MemberUrl + "' title='" + this.Name + "' class='pic'> <img src='" + this.PhotoUrl + "' alt='" + this.Name + "'  width=\"45\" height=\"45\"/></a>" +
                        "<div class='right_content'> <a href='" + this.MemberUrl + "'>" + this.Name + "</a>" +
                        "<a href='" + this.MessageURL + "'> " + this.Subject + "</a>" +
                        "<span class='notificationDate'>" + formattedDate.toString() + "</span></div></li>";
                        })
                        jQuery('#dvMessages').empty();
                        jQuery('#dvMessages').html(obj);
                    }
                    else if (type == 2) {
                        obj = '';
                        jQuery(data).each(function () {
                            obj += "<li><a href='" + this.MemberUrl + "' title='" + this.Name + "' class='pic'><img src='" +
                              this.PhotoUrl + "'  alt='" + this.Name + "' width=\"45\" height=\"45\" /></a>" +
                              "<div class='right_content'><div> <a href='" + this.ArticleUrl + "'>" + ((this.Comment.length > 100) ? (this.Comment.substring(0, 100) + "...") : (this.Comment)) + "</a></div>" +
                              "<div><span class='notificationDate'>" + this.Date + "</span></div></div></li>";
                        });
                        jQuery('#dvComments').empty();
                        jQuery('#dvComments').html(obj);
                    }
                    else {
                        obj = '';
                        jQuery(data).each(function () {
                            obj += "<li>" + this.Message + "<div class='notificationDate'>" +
                            this.CreatedDate + "</div></li>";
                        })
                        jQuery('#dvGeneralNotifications').empty();
                        jQuery('#dvGeneralNotifications').html(obj);
                    }
                }
                else {
                    if (type == 1)
                        jQuery('#LabelNoData').show();
                    else if (type == 2)
                        jQuery('#LabelNoComments').show();
                    else
                        jQuery('#LabelNoDataNotifications').show();
                }
            },
            complete: function () {
                if (type == 1) {
                    jQuery('#imgMessages').hide();
                    jQuery(".icons.message")[0].title = "You have no unread message";
                }
                if (type == 2) {
                    jQuery('#imgComments').hide();
                    jQuery(".icons.comments")[0].title = "You have no unread comment";
                }
                if (type == 3) {
                    jQuery('#imgGeneralNotifications').hide();
                    jQuery(".icons.notification")[0].title = "You have no unread notification";
                }
            }
        });
    }
}



function GetNotificationCounts() {
    jQuery.ajax({
        url: "/WebServices/CommonServices.asmx/GetNotificationCount",
        type: "POST",
        dataType: "JSON",
        contentType: "application/json",
        success: function (data) {
            jQuery(".loginControl .messageCount").html('').hide();
            if (data.d != null) {
                var NotificationCounts = JSON.parse(data.d);
                var NotificationMessageCount = NotificationCounts[0].NotificationMessageCount;
                var NotificationGeneralCount = NotificationCounts[0].NotificationGeneralCount;
                var NotificationCommentCount = NotificationCounts[0].NotificationCommentCount;
                if (NotificationCommentCount != 0 && jQuery(".icons.comments").length != 0) {
                    jQuery("#spanCommentsNotifications").html(NotificationCommentCount).show();
                    jQuery(".icons.comments")[0].title = "You have " + ((NotificationCommentCount == 0) ? "no" : NotificationCommentCount) + " unread comment" + ((NotificationCommentCount > 1) ? "s" : "");
                }
                if (NotificationMessageCount != 0 && jQuery(".icons.message").length != 0) {
                    jQuery("#spanMessages").html(NotificationMessageCount).show();
                    jQuery(".icons.message")[0].title = "You have " + ((NotificationMessageCount == 0) ? "no" : NotificationMessageCount) + " unread message" + ((NotificationMessageCount > 1) ? "s" : "");

                }
                if (NotificationGeneralCount != 0 && jQuery(".icons.notification").length != 0) {
                    jQuery("#spanGeneralNotifications").html(NotificationGeneralCount).show();
                    jQuery(".icons.notification")[0].title = "You have " + ((NotificationGeneralCount == 0) ? "no" : NotificationGeneralCount) + " unread notification" + ((NotificationGeneralCount > 1) ? "s" : "");
                }
            }
        },
        error: function (err) {
            console.log("Error");
        }
    });
}





function logout() {
    jQuery.ajax({
        type: "POST",
        url: "/WebServices/CommonServices.asmx/LogOffUser",
        contentType: "application/json; charset=utf-8",
        beforeSend: function () { jQuery(".logout.loader").show() },
        dataType: "json",
        success: function (r) {
            if (r.d === true) {
                clearCookies();
                window.location = window.location.pathname;
            }
        }, complete: function () { jQuery(".logout.loader").hide() }
    });
}

function clearCookies() {
    var now = new Date(); now.setDate(now.getDate() + 30);

    var notificationCookie = '';
    var GBID = '';
    var FilterRecent = '';
    if (document.cookie.indexOf("notificationId") > -1) {
        notificationCookie = document.cookie.substr(document.cookie.indexOf("notificationId")) + ";expires=" + now.toUTCString() + ";path=/";
    }
    if (document.cookie.indexOf("GBID") > -1) {
        GBID = document.cookie.substr(document.cookie.indexOf("GBID")) + ";expires=" + now.toUTCString() + ";path=/";
    }
    if (document.cookie.indexOf("FilterRecent") > -1) {
        FilterRecent = document.cookie.substr(document.cookie.indexOf("FilterRecent")) + ";path=/";
    }
    document.cookie.split(";").forEach(function (c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
    if (notificationCookie !== '') { document.cookie = notificationCookie; };
    if (GBID !== '') { document.cookie = GBID; };
    if (FilterRecent !== '') { document.cookie = FilterRecent; };
}

/*Notificaiton Count Function End*/


/*To prevent question mark in C# search*/
function preventQuestionMark(e) {
    var keyCode = (e.which) ? e.which : e.keyCode;
    if (keyCode === 191) {
        return false;
    }
    return true

}


var infocusCounter = 0;
var widthContainer;
//var inFoucsTimeOuts = [];

function animateinFocus() {
    infocusCounter++;
    infocusCounter %= arrInFocus.length;
    jQuery("#InFocus").attr("href", arrInFocus[infocusCounter].Url);
    var arrInfocusChars = arrInFocus[infocusCounter].Title.split("");
    jQuery("#InFocus").html("");
    var isOverflow = false;
    jQuery.each(arrInfocusChars, function (i, letter) {
        setTimeout(function () {
            if (!isOverflow) {
                jQuery('#InFocus').html(jQuery('#InFocus').html() + letter);
            }
            if (i == (arrInfocusChars.length - 1)) {
                setTimeout(function () { animateinFocus(); }, 4000);
            }
        }, 50 * i);
    });
}

/*Infocus animation Script--End*/
